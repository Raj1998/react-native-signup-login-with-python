from google.oauth2 import id_token
from google.auth.transport import requests

# (Receive token by HTTPS POST)
# ...
token = "eyJhbGciOiJSUzI1NiIsImtpZCI6ImFmZGU4MGViMWVkZjlmM2JmNDQ4NmRkODc3YzM0YmE0NmFmYmJhMWYiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJhenAiOiIxODIxNDMwOTk3MzgtbGt1amRwdDZybDBvb2VkNDlmcHJzdTNmMXJkbmlybTMuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJhdWQiOiIxODIxNDMwOTk3MzgtbGt1amRwdDZybDBvb2VkNDlmcHJzdTNmMXJkbmlybTMuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJzdWIiOiIxMTMwMzcwMzU5MzIzODA1NDg3MTMiLCJlbWFpbCI6Im5ld2NyMjAxNzdAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImF0X2hhc2giOiJHSURSbjJLTlBYUUQ3cEl5dFdKWERRIiwibmFtZSI6Ik1yLiBSIiwicGljdHVyZSI6Imh0dHBzOi8vbGgzLmdvb2dsZXVzZXJjb250ZW50LmNvbS8tbkdOelBrek1OUnMvQUFBQUFBQUFBQUkvQUFBQUFBQUFBQUEvQUNIaTNyZjFneTdCZTluT3BldUZyanpyYXR1ekNVMEhvdy9zOTYtYy9waG90by5qcGciLCJnaXZlbl9uYW1lIjoiTXIuIiwiZmFtaWx5X25hbWUiOiJSIiwibG9jYWxlIjoiZW4tR0IiLCJpYXQiOjE1NjI0MjA4NzUsImV4cCI6MTU2MjQyNDQ3NX0.Nv2xPWFUt2U2t7RX-5o5ZdsklKsW2nelsLKFj7XmrbchLO5GyuaI8_ieB2FxowMymics0eljI0gFB2bHM6Iy63AnCZEh_cBfbFYEr2KvQkNBk_3hzvpXAscOEKIlMEclYhKYoiTjI0aZ_OncYrf3PaKQvrXqf1d5iNIkYmNTqBKtbC9RawnVleHyVIJju9MZ_HKLUH83vfHDPfREZox6DbbBSGBrr0ZnCf9N9OlK8aG02WqGFsTx5cYOuOf_qp_cc9ZExgMjFEQJFUoUkZjDLkLWNBL9CD_krlI9p54VOqSHBdlhJi1lb7pbH0uHpAOVF8eHO1KuQf-t8ubkM6xRdw"
token = "eyJhbGciOiJSUzI1NiIsImtpZCI6ImFmZGU4MGViMWVkZjlmM2JmNDQ4NmRkODc3YzM0YmE0NmFmYmJhMWYiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJhenAiOiIxODIxNDMwOTk3MzgtbGt1amRwdDZybDBvb2VkNDlmcHJzdTNmMXJkbmlybTMuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJhdWQiOiIxODIxNDMwOTk3MzgtbGt1amRwdDZybDBvb2VkNDlmcHJzdTNmMXJkbmlybTMuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJzdWIiOiIxMTMwMzcwMzU5MzIzODA1NDg3MTMiLCJlbWFpbCI6Im5ld2NyMjAxNzdAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImF0X2hhc2giOiJQdlJaT3hINGtfSGw4V3ZyWVV3a0FRIiwibmFtZSI6Ik1yLiBSIiwicGljdHVyZSI6Imh0dHBzOi8vbGgzLmdvb2dsZXVzZXJjb250ZW50LmNvbS8tbkdOelBrek1OUnMvQUFBQUFBQUFBQUkvQUFBQUFBQUFBQUEvQUNIaTNyZjFneTdCZTluT3BldUZyanpyYXR1ekNVMEhvdy9zOTYtYy9waG90by5qcGciLCJnaXZlbl9uYW1lIjoiTXIuIiwiZmFtaWx5X25hbWUiOiJSIiwibG9jYWxlIjoiZW4tR0IiLCJpYXQiOjE1NjI0NjA3NjksImV4cCI6MTU2MjQ2NDM2OX0.YFC5gFQYRdHeLvMEQQ33o53IRHnoPIIuwjiErdsitGcKac3WRc-DUO9CpQKhhoJcXNNPssVT9jMNv5Mt2U0C5Cof3ppLA3D98RuMlJt_-z3EJBIi3ahASTIkFZ9SczE0vBw8fjh4fQpJXjubJe9CwqD2gUEr6x2Zy3NDSZy5gsW0BcSrmBl0OuLmmfE4OVrprjVsceJJAkUafx5N-p9ak-94Apnos_6Y0feYIajdVEdYCzHqbzw49eqb_aCacTL5yGqES9vhzBnySEY2ZpRXOAapvKUhaDL8qESsCaEtAI33IlORLw1josGcySxJMWR2cfobcnf5R6nalcPrm-SpfQ"
token = "eyJhbGciOiJSUzI1NiIsImtpZCI6ImFmZGU4MGViMWVkZjlmM2JmNDQ4NmRkODc3YzM0YmE0NmFmYmJhMWYiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJhenAiOiIxODIxNDMwOTk3MzgtbGt1amRwdDZybDBvb2VkNDlmcHJzdTNmMXJkbmlybTMuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJhdWQiOiIxODIxNDMwOTk3MzgtbGt1amRwdDZybDBvb2VkNDlmcHJzdTNmMXJkbmlybTMuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJzdWIiOiIxMTMwMzcwMzU5MzIzODA1NDg3MTMiLCJlbWFpbCI6Im5ld2NyMjAxNzdAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImF0X2hhc2giOiJoN2JHT3I2NTVvWGxTTmdxbTFWeWJBIiwibmFtZSI6Ik1yLiBSIiwicGljdHVyZSI6Imh0dHBzOi8vbGgzLmdvb2dsZXVzZXJjb250ZW50LmNvbS8tbkdOelBrek1OUnMvQUFBQUFBQUFBQUkvQUFBQUFBQUFBQUEvQUNIaTNyZjFneTdCZTluT3BldUZyanpyYXR1ekNVMEhvdy9zOTYtYy9waG90by5qcGciLCJnaXZlbl9uYW1lIjoiTXIuIiwiZmFtaWx5X25hbWUiOiJSIiwibG9jYWxlIjoiZW4tR0IiLCJpYXQiOjE1NjI0NjEwNDksImV4cCI6MTU2MjQ2NDY0OX0.v_YhzYVYl5qsBTm70q0qzvZeQtea1gNiE4yAmCZu26OC3dITexXsZ_wiXiWBmbjMSCLWlqFla5eoLixwFqU8aS5o-fb903BlV1IhG31pUIodmignoPCfDK2-H7Xp5gW8ZSGItSNZozrf8mrQapnFqM0dVJpeGzatQk939GzUmVlKgQMzUN9jj4wOjxAomdF13H0Ak0XR1lRzf57uVz6uoIMqRJOU7L-vs8JDGdTmY59jRjCCzwCFw41L_bsiGcVA-HIu2fWe6rk5V8wKO5DYznL_-Frqp0XnFEy5cr9oE3JwCI7Zt21OAJkY7tYCXjehYgad5laAnPIJq4bZ-FxzEQ"
CLIENT_ID = "182143099738-lkujdpt6rl0ooed49fprsu3f1rdnirm3.apps.googleusercontent.com"

try:
    # Specify the CLIENT_ID of the app that accesses the backend:
    idinfo = id_token.verify_oauth2_token(token, requests.Request(), CLIENT_ID)

    # Or, if multiple clients access the backend server:
    # idinfo = id_token.verify_oauth2_token(token, requests.Request())
    # if idinfo['aud'] not in [CLIENT_ID_1, CLIENT_ID_2, CLIENT_ID_3]:
    #     raise ValueError('Could not verify audience.')

    if idinfo['iss'] not in ['accounts.google.com', 'https://accounts.google.com']:
        print("wrong issuer")
        raise ValueError('Wrong issuer.')

    # If auth request is from a G Suite domain:
    # if idinfo['hd'] != GSUITE_DOMAIN_NAME:
    #     raise ValueError('Wrong hosted domain.')

    # ID token is valid. Get the user's Google Account ID from the decoded token.
    userid = idinfo['sub']
    print(userid)
except ValueError:
    # Invalid token
    print("exception - invalid token")
except:
    print("general exptn")